---
dist: xenial

sudo: required

addons:
  sonarcloud:
    organization: "stefanoagazzi-github"
    token:
      secure: >
        "UCAuOivREltP72Tagzrz5PK8ZSUaBvjWZTjTRlaTL4mIt4qYCNR0SFvdP06cuk5urd2u+uMb
        Lncv0dQRsBefjKmv8Z+eeKu907mG0BbiW+rAY2Qzo7vGX+y8L8PzQ7MkQ69x6UvEodEW9JbdH
        6z7fS3I0xgaFiI6sUE3Syb2cR4fR7CHsiFedjHxurvQkyND2l3J0eZa3JlDX8XuPRuCZMFkeD
        kurkSfwAYZs9912nkgDRLQiik+9a0y3P0HgoZTsHGol8gNwUDdfY3ORxOhfYkYKN6eilLN53E
        vClVa7jTHNDOJH3yiWhUiUyJ3uo+uiki7ZFlBOrn2QCbl8nTf7AHaeR2GqOHgEiCCpbW05n5E
        svcQBrB2cOaX5hQnDvbcN9lFBbFKGisIrG6iu5o87235LuiGfiRggfiMiuLkclGUTUv2vv7HH
        fZPFFjZGWizRUT9zD3gkBbCo4ZVjg6AYJ2eUUh16E1RuDHaT00hTC4U2ebbPpigsPoBQkw/n9
        n5CMPIq+QTMtVKwS7uVUyaJvevKBXuuzZL059rS9whTErEYOKJq0jHfsA3Hp4V8ptYHRfGc79
        Te73/yzu5jhHR+DiDC4mTMqro5wb6NzfXFzm2Il7SfnG7YG1aRCcUpDMSH+ExZy1pXfnJJ+cm
        RUnjrPUeGBVCSyoGOyK4CC6XBtk="

jdk:
  - openjdk8

language: python
python:
  - "3.7"

services:
  - docker

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install --assume-yes docker-ce
  - docker --version

install:
  - pip install molecule ansible docker-py
  - pip install -r requirements.txt

script:
  - ansible-lint tasks/main.yml
  - molecule test
  - sonar-scanner

cache:
  directories:
    - '$HOME/.sonar/cache'

notifications:
  webhooks: https://galaxy.ansible.com/api/v1/notifications/
